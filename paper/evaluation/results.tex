% !TeX root = ../thesis.tex

\section{Results}

\subsection{RQ1: Probability of failure}\label{ssec:results-rq1}
The two pie charts in \Cref{fig:rq1-failure-probability} illustrate the amount of failed and successful test runs. The leftmost chart visualises the failure rate in the dataset \cite{travisanalysis} by Durieux et al. $\SI{4558279}{}$ test runs out of the $\SI{28882003}{}$ total runs have failed, which corresponds to a failure probability of $\SI{18.74}{\percent}$. The other pie chart uses data from the TravisTorrent \cite{msr17challenge} project. Since the cause of failure can be inferred from this dataset, it is possible to obtain more accurate results. $\SI{42.89}{\percent}$ of the failed runs are due to a compilation failure where the test suite did not execute. For the remaining part of the runs, $\SI{225766}{}$ out of $\SI{2114920}{}$ executions contain at least one failed test case, corresponding to a failure percentage of $\SI{10.67}{\percent}$.

\begin{figure}[htbp!]
	\centering
	\includegraphics[width=\textwidth]{assets/charts/rq1-failure-probability.pdf}
	\caption{Probability of test run failure}
	\label{fig:rq1-failure-probability}
\end{figure}

\subsection{RQ3: Average duration of a test run}
The dataset by Durieux et al. \cite{travisanalysis} has been refined to only include test runs that did not finish within $\SI{10}{s}$. A lower execution time generally indicates that the test suite did not execute and that a compilation failure has occurred instead. \Cref{tbl:rq2-characteristics} contains the characteristics of the remaining $\SI{24320504}{}$ analysed test runs. The median and average execution times suggest that primarily small projects are \travisci{}, yet the maximum value is very high. \Cref{fig:rq2-durations} confirms that $\SI{71378}{}$ test runs have taken longer than one hour to execute. Further investigation has revealed that these are typically projects which are using mutation testing, such as \texttt{plexus/yaks}\footnote{A Ruby library for hypermedia (\url{https://github.com/plexus/yaks}).}.

\begin{table}[h]
	\centering
	\begin{tabularx}{\textwidth}{|C|C|C|C|C|}
		\hline
		\textbf{\# runs} & \textbf{Minimum} & \textbf{Mean} & \textbf{Median} & \textbf{Maximum}\\
		\hline
		$\SI{24320504}{}$ & $\SI{10}{\second}$ & $\SI{385}{\second}$ & $\SI{178}{\second}$ & $\SI{26}{\hour} \SI{11}{\minute} \SI{26}{\second}$\\
		\hline
	\end{tabularx}
	\caption{Characteristics of the test run durations in \cite{travisanalysis}.}
	\label{tbl:rq2-characteristics}
\end{table}

\begin{figure}[htbp!]
	\centering
	\includegraphics[width=\textwidth]{assets/charts/rq2-test-run-durations.pdf}
	\caption{Test run durations on \travisci{}}
	\label{fig:rq2-durations}
\end{figure}


\subsection{RQ3: Consecutive failure probability}
Because the TravisTorrent project is the only dataset that contains the identifier of the previous run, only runs from this project have been used. This dataset consists of $\SI{211040}{}$ test runs, immediately following a failed execution. As illustrated in \Cref{fig:rq3-consecutive-failure}, $\SI{109224}{}$ of these test runs have failed as well, versus $\SI{101816}{}$ successful test runs ($\SI{51.76}{\percent}$).

\begin{figure}[htbp!]
	\centering
	\includegraphics[width=\textwidth]{assets/charts/rq3-consecutive-failure.pdf}
	\caption{Consecutive test run failures on \travisci{}}
	\label{fig:rq3-consecutive-failure}
\end{figure}

\subsection{RQ4: Applying \tcp{} to Dodona}
After executing the $\SI{62}{}$ failed test runs, the log files have been inspected. The log files have revealed that $\SI{9}{}$ test runs have failed because of an error in the configuration, rather than due to a failing test case. These test runs have therefore been omitted from the results because the test suite did not execute. Configuration problems require in-depth contextual information about the project and can therefore not be predicted.\\

\noindent \Cref{tbl:rq4-first-failure} contains the amount of executed test cases until the first failure is observed. These results indicate that every predictor but one\footnote{The AllInOrder algorithm can be considered as a  deterministic random algorithm, rather than an actual predictor.}, is capable of performing at least one successful prediction. Furthermore, the maximum amount of executed test cases is lower than the original value, which means that every algorithm is a valid predictor. The data suggests that the Alpha algorithm and the HGS algorithm are the preferred predictors for the Dodona project, while the ROCKET algorithm does not achieve a good performance.

\begin{table}[h]
	\centering
	\begin{tabularx}{\textwidth}{|X||c|c|c|c|}
		\hline
		\textbf{Algorithm} & \textbf{Minimum} & \textbf{Mean} & \textbf{Median} & \textbf{Maximum}\\
		
		\hline
		
		\emph{Original} & $\SI{0}{}$ & $\SI{143}{}$ & $\SI{65}{}$ & $\SI{563}{}$\\
		
		\hline
		
		Alpha & $\SI{0}{}$ & $\SI{7}{}$ & $\SI{6}{}$ & $\SI{44}{}$\\
		
		\hline
		AffectedRandom & $\SI{0}{}$ & $\SI{82}{}$ & $\SI{18}{}$ & $\SI{428}{}$\\
		AllInOrder & $\SI{1}{}$ & $\SI{102}{}$ & $\SI{71}{}$ & $\SI{455}{}$\\
		AllRandom & $\SI{0}{}$ & $\SI{71}{}$ & $\SI{16}{}$ & $\SI{477}{}$\\
		
		\hline
		
		GreedyCoverAffected & $\SI{31}{}$ & $\SI{307}{}$ & $\SI{296}{}$ & $\SI{446}{}$\\
		GreedyCoverAll & $\SI{0}{}$ & $\SI{85}{}$ & $\SI{32}{}$ & $\SI{467}{}$\\
		GreedyTimeAll & $\SI{0}{}$ & $\SI{209}{}$ & $\SI{172}{}$ & $\SI{452}{}$\\
		
		\hline
		
		HGSAffected & $\SI{0}{}$ & $\SI{54}{}$ & $\SI{10}{}$ & $\SI{511}{}$\\
		HGSAll & $\SI{0}{}$ & $\SI{109}{}$ & $\SI{6}{}$ & $\SI{487}{}$\\
		
		\hline
		
		ROCKET & $\SI{0}{}$ & $\SI{208}{}$ & $\SI{170}{}$ & $\SI{452}{}$\\
		
		\hline
	\end{tabularx}
	\caption{Amount of executed test cases until the first failure.}
	\label{tbl:rq4-first-failure}
\end{table}

\noindent The previous results have been visualised in \Cref{fig:rq4-performance}. These charts confirm the low accuracy of the ROCKET algorithm. The Alpha algorithm and the HGS algorithm offer the most accurate predictions, with the former algorithm being the most consistent. Notice the chart of the Greedy algorithm, which succeeds in successfully predicting some of the test runs, while failing to predict others. This behaviour is specific to a greedy heuristic.\\

\clearpage

\begin{figure}[!hbp]
	\subfloat[Alpha algorithm]{%
		\includegraphics[width=\textwidth]{assets/charts/rq4-dodona-alpha.pdf}
	}
\end{figure}
\begin{figure}[!hbp]
	\ContinuedFloat
	\subfloat[Greedy algorithm]{%
		\includegraphics[width=\textwidth]{assets/charts/rq4-dodona-greedy.pdf}
	}
\end{figure}
\begin{figure}[!hbp]
	\ContinuedFloat
	\subfloat[HGS algorithm]{%
		\includegraphics[width=\textwidth]{assets/charts/rq4-dodona-hgs.pdf}
	}
\end{figure}
\begin{figure}[!t]
	\ContinuedFloat
	\centering
	\subfloat[ROCKET algorithm]{%
		\includegraphics[width=\textwidth]{assets/charts/rq4-dodona-rocket.pdf}
	}
	\caption{Prediction performance on the Dodona project}
	\label{fig:rq4-performance}
\end{figure}


\noindent The duration until the first observed failure is reported in \Cref{tbl:rq4-first-failure-duration}. Observe that the previous table indicates that the ROCKET algorithm does not perform well, while this table suggests otherwise. This behaviour is explained by the objective function of this algorithm, which prioritises test cases with a low execution time to be executed first.

\begin{table}[htbp!]
	\centering
	\begin{tabularx}{\textwidth}{|X||c|c|c|c|}
		\hline
		\textbf{Algorithm} & \textbf{Minimum} & \textbf{Mean} & \textbf{Median} & \textbf{Maximum}\\
		
		\hline
		
		\emph{Original} & $\SI{0}{\second}$ & $\SI{154}{\second}$ & $\SI{125}{\second}$ & $\SI{622}{\second}$\\
		
		\hline
		
		Alpha & $\SI{0}{\second}$ & $\SI{5}{\second}$ & $\SI{0}{\second}$ & $\SI{84}{\second}$\\
		
		\hline
		AffectedRandom & $\SI{0}{\second}$ & $\SI{64}{\second}$ & $\SI{10}{\second}$ & $\SI{355}{\second}$\\
		AllInOrder & $\SI{0}{\second}$ & $\SI{177}{\second}$ & $\SI{171}{\second}$ & $\SI{456}{\second}$\\
		AllRandom & $\SI{0}{\second}$ & $\SI{64}{\second}$ & $\SI{11}{\second}$ & $\SI{611}{\second}$\\
		
		\hline
		
		GreedyCoverAffected & $\SI{6}{\second}$ & $\SI{123}{\second}$ & $\SI{109}{\second}$ & $\SI{264}{\second}$\\
		GreedyCoverAll & $\SI{0}{\second}$ & $\SI{60}{\second}$ & $\SI{25}{\second}$ & $\SI{306}{\second}$\\
		GreedyTimeAll & $\SI{0}{\second}$ & $\SI{44}{\second}$ & $\SI{15}{\second}$ & $\SI{178}{\second}$\\
		
		\hline
		
		HGSAffected & $\SI{0}{\second}$ & $\SI{58}{\second}$ & $\SI{6}{\second}$ & $\SI{581}{\second}$\\
		HGSAll & $\SI{0}{\second}$ & $\SI{130}{\second}$ & $\SI{16}{\second}$ & $\SI{578}{\second}$\\
		
		\hline
		
		ROCKET & $\SI{0}{\second}$ & $\SI{47}{\second}$ & $\SI{16}{\second}$ & $\SI{178}{\second}$\\
		
		\hline
	\end{tabularx}
	\caption{Duration until the first failure.}
	\label{tbl:rq4-first-failure-duration}
\end{table}

\clearpage

\subsection{RQ5: Integrate \velocity{} with Stratego}
The data collection phase has already proven that the Java agent is compatible with Stratego. Since \velocity{} is not yet able to predict test cases which have been added in the current commit, only $\SI{35}{}$ of the $\SI{54}{}$ failed test runs could be used.\\

\noindent Similar to the previous test subject, \Cref{tbl:rq5-first-failure} enlists how many test cases have been executed before the first failure. The table only considers the four main algorithms, since the actual prediction performance was only secondary to this research question and only a small amount of test runs have been analysed. The results suggest that every algorithm except the ROCKET achieves a high prediction accuracy on this project.

\begin{table}[h]
	\centering
	\begin{tabularx}{\textwidth}{|X||c|c|c|c|}
		\hline
		\textbf{Algorithm} & \textbf{Minimum} & \textbf{Mean} & \textbf{Median} & \textbf{Maximum}\\
		
		\hline
		
		\emph{Original} & $\SI{0}{}$ & $\SI{68}{}$ & $\SI{2}{}$ & $\SI{278}{}$\\
		
		\hline
		
		Alpha & $\SI{0}{}$ & $\SI{10}{}$ & $\SI{2}{}$ & $\SI{57}{}$\\
		
		\hline
		
		GreedyCoverAll & $\SI{0}{}$ & $\SI{11}{}$ & $\SI{3}{}$ & $\SI{57}{}$\\
		
		\hline
		
		HGSAll & $\SI{0}{}$ & $\SI{9}{}$ & $\SI{4}{}$ & $\SI{50}{}$\\
		
		\hline
		
		ROCKET & $\SI{0}{}$ & $\SI{42}{}$ & $\SI{27}{}$ & $\SI{216}{}$\\
		
		\hline
	\end{tabularx}
	\caption{Amount of executed test cases until the first failure.}
	\label{tbl:rq5-first-failure}
\end{table}

\noindent Even though the performance of the ROCKET algorithm is suboptimal in the previous table, \Cref{tbl:rq5-first-failure-duration} does indicate that it outperforms every other algorithm time-wise. Notice that the predicted sequence of the HGS algorithm takes the longest to execute, while the previous table suggested a good prediction accuracy. The Alpha and Greedy algorithms seem very similar on both the amount of executed test cases, as well as the execution time.

\begin{table}[h]
	\centering
	\begin{tabularx}{\textwidth}{|X||c|c|c|c|}
		\hline
		\textbf{Algorithm} & \textbf{Minimum} & \textbf{Mean} & \textbf{Median} & \textbf{Maximum}\\
		
		\hline
		
		\emph{Original} & $\SI{0}{\second}$ & $\SI{62}{\second}$ & $\SI{8}{\second}$ & $\SI{233}{\second}$\\

		\hline
		
		Alpha & $\SI{0}{\second}$ & $\SI{11}{\second}$ & $\SI{2}{\second}$ & $\SI{103}{\second}$\\
		
		\hline
		
		GreedyCoverAll & $\SI{0}{\second}$ & $\SI{12}{\second}$ & $\SI{2}{\second}$ & $\SI{103}{\second}$\\
		
		\hline
		
		HGSAll & $\SI{0}{\second}$ & $\SI{19}{\second}$ & $\SI{1}{\second}$ & $\SI{130}{\second}$\\
		
		\hline
		
		ROCKET & $\SI{0}{\second}$ & $\SI{6}{\second}$ & $\SI{0}{\second}$ & $\SI{85}{\second}$\\
		
		\hline
	\end{tabularx}
	\caption{Amount of executed test cases until the first failure.}
	\label{tbl:rq5-first-failure-duration}
\end{table}

\noindent \Cref{fig:rq5-performance} further confirms the above statements. Notice the close resemblance of the charts of the Greedy algorithm and the Alpha algorithm, indicating that almost every test run failure was caused by a different failing test case. The ROCKET algorithm performs better on this project than on Dodona, yet not accurate.

\begin{figure}[!hbp]
	\subfloat[Alpha algorithm]{%
		\includegraphics[width=\textwidth]{assets/charts/rq5-stratego-alpha.pdf}
	}
\end{figure}
\begin{figure}[!hbp]
	\ContinuedFloat
	\subfloat[Greedy algorithm]{%
		\includegraphics[width=\textwidth]{assets/charts/rq5-stratego-greedy.pdf}
	}
\end{figure}
\begin{figure}[!hbp]
	\ContinuedFloat
	\subfloat[HGS algorithm]{%
		\includegraphics[width=\textwidth]{assets/charts/rq5-stratego-hgs.pdf}
	}
\end{figure}
\begin{figure}[!hbp]
	\ContinuedFloat
	\centering
	\subfloat[ROCKET algorithm]{%
		\includegraphics[width=\textwidth]{assets/charts/rq5-stratego-rocket.pdf}
	}
	\caption{Prediction performance on the Stratego project}
	\label{fig:rq5-performance}
\end{figure}